---
title: "Modeling Data Formats, Modeling and Event Detection Parameters"
author: "Dawn Nekorchuk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Data, Model and Event Detection Parameters



# Data & Data Formats

The epidemiar modeling and code requires 3 main sets of data: epidemiological data, daily environmental data, and historical environmental reference data, plus several information/reference tables. 

## Epidemiology Data

For the epidemiology data, you will need weekly case counts of the disease/illness per the geographic unit (group) with base population values (to calculate incidence).  

When calling the epidemiar function:

* epi_data:  Epidemiological data with case numbers per week, with date field "obs_date". The date should be the _last_ day of the epidemiological week. 
* casefield: Give the field name for the case counts
* populationfield:  Give the population field to give population numbers over time. Used to calculated incidence. Also optionally used in Farrington method for populationOffset.
* groupfield:  Give the field name for districts or area divisions of epidemiological AND environmental data. If there are no groupings (all one area), user should give a field with the same value throughout the entire datasets. 

### Missing Data

There should be a line for each week and geographic grouping, even for missing data (i.e. explicit missing data). 
Any missing data will be filled in by linear interpolation inside of the epidemiar modeling functions. 

## Environmental Data

For the environmental data, daily data is expected for each environmental variable for each geographic unit. Based on the lag length chosen, you must have at least that number of days _before_ the first epidemiology data date.  

When calling the epidemiar function:

* env_data:  Environmental data values for each geographic grouping, with date field 'obs_date'
* groupfield:  Give the field name for districts or area divisions of epidemiological AND environmental data. If there are no groupings (all one area), user should give a field with the same value throughout the entire datasets. 
* obsfield: Give the field name of the environmental data observation types
* valuefield: Give the field name of the value of the environmental data observations

### Non-daily or Missing Data

If you do not have daily data, or have implicit missing data, you can use the 'data_to_daily()' function to add any missing rows. This function will also use linear interpolation to fill in values in possible (default 'interpolate = TRUE').  Note: this will not fill out ragged data (different end dates of environmental variable data), but that will be handled inside of epidemiar. 


## Environmental Reference / Weekly Climate Data

The environmental reference / climate data should contain a reference value (e.g. mean) of the environmental variable per geographic group for each week of the year. 
The groupfield, obsfield should match the field names in the environmental dataset.  

## Reference Tables
1. Environmental variables
This file lists the environmental variables and their aggregation method for the weekly environmental reference data (e.g. rainfall could be the 'sum' of the daily values, while LST would be the 'mean' value).

* obsfield: Give the field name of the environmental data variables, should match the environmental and environmental reference data
* 'reference_method': 'sum' or 'mean'
* 'report_label': Label to be used in creating the formatted report graphs
* 'environ_var_id': ID value that used in the model info file on the environmental variables to be used in the model.

2. Model variables and geographic group clusters
This file gives the list of environmental variables to use, and any geographic clustering to be used in the model calculations (e.g. cluster is a variable in the modeling regression). 

* 'vars.1' through 'vars.x' fields, where x is the number of environmental variables to be used in the modeling. The value should correspond to the 'environ_var_id' field in the environmental info reference file. 
* 'cluster.1' through 'cluster.n', where n is the number of geographic units (groupfield values) in the epi/env data. The numeric value of the field name (e.g. 1 of cluster.1) is the 'group_id', or the id value for that geographic unit. The value of the field is the cluster id value, e.g. which cluster the geographic unit belongs to. The 'group_id' crosswalk should be given in the geographic group code file. 

3. Geographic group codes
This file contains a crosswalk of the geographic unit IDs/descriptions. 
* 'group_id' is the ID value corresponding to the cluster information in the model variables and geographic group cluster file. 
* groupfield: is the same given field name for the geographic unit groups when 'run_epidemia()' was called. 



<!-- Population table, shapefiles, woreda reference table, for Ethiopia --> 

# Data Requirements

## Epidemiology Data

## Environmental Data

## Environmental Reference / Weekly Climate Data

## Reference Tables
1. Environmental variables
2. Model variables and geographic group clusters
3. Population
4. Shapefiles


# Setting up the Model


## Environmental variables
## Geographic grouping clusters

# Setting up for Event Detection
1. Picking the algorithm
1. Settings .... 
